<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>mjamiv BTC Tracker</title>
  <meta name="theme-color" content="#1a1a1a"/>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>

  <!-- CSV parsing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js" integrity="sha512-+FhZsDkQ0+Jm1+zqg2mVY9E5wF9an9f8pCw7t7E4m2r8mW2o0Vn8b2YH9k5o9b1cJ6W1l3C2s0m0+fN2j3n3xQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Chart.js + date-fns adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>

  <!-- Annotation plugin (must come after Chart.js) -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

  <!-- noUiSlider for date‐range slider -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root {
      --bg: #0f1115;
      --bg-elev: #151922;
      --panel: #1b2130;
      --panel2: #222a3b;
      --gold: #ffd36b;
      --text: #f5f7fb;
      --muted: #9aa3b2;
      --accent: #5ac8fa;
      --accent2: #7c4dff;
      --good: #39ff14;
      --bad: #ff4d4d;
      --border: rgba(255,211,107,0.6);
      --shadow: rgba(0,0,0,0.55);
      --ring: 0 0 0 2px rgba(90,200,250,0.25);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; color: var(--text); background: radial-gradient(1200px 600px at 15% -10%, #1a2030 0%, #0f1115 55%), var(--bg);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      letter-spacing: .2px;
    }
    .container { max-width: 1280px; margin: 0 auto; padding: 24px 20px 40px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom: 18px; }
    .brand { display:flex; align-items:center; gap:14px; }
    .brand img { width:56px; height:56px; border-radius:12px; box-shadow: 0 10px 24px rgba(0,0,0,.35); }
    .brand h1 { font-size: 1.35rem; margin:0; font-weight:800; letter-spacing:.4px; }
    .brand p { margin:0; color: var(--muted); font-size: .9rem; }
    .actions { display:flex; gap:10px; }
    .btn {
      display:inline-flex; align-items:center; gap:8px;
      background: linear-gradient(180deg, #ffd36b, #e7b84d);
      border: 0; color: #241a00; padding: 10px 14px; font-weight: 700; border-radius: 10px; cursor: pointer;
      box-shadow: 0 6px 18px rgba(255, 211, 107, .25);
      transition: transform .1s ease, box-shadow .2s ease;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 10px 22px rgba(255, 211, 107, .35); }
    .btn:active { transform: translateY(0); }
    .btn.secondary {
      background: linear-gradient(180deg, #2a3347, #1d2434);
      color: var(--text); border: 1px solid #2e3a52;
      box-shadow: 0 6px 16px rgba(0,0,0,.35);
    }
    .title-image { display:block; width:100%; max-width:560px; height:auto; border-radius: 14px; opacity: .95; }

    /* Split Tile at the very top */
    .split-tile {
      display:flex; align-items:stretch; gap:0; background: linear-gradient(135deg, #1b2130, #121826);
      border: 1px solid var(--border); border-radius:16px; margin: 18px 0 22px;
      overflow:hidden; box-shadow: 0 12px 28px var(--shadow);
    }
    .split-half {
      flex:1; padding:18px 20px; display:flex; align-items:center; gap:14px; position:relative;
    }
    .split-half:focus-within { outline: none; box-shadow: var(--ring) inset; }
    .split-half .icon {
      font-size:1.6rem; color: var(--gold); width:34px; text-align:center; filter: drop-shadow(0 2px 6px rgba(255,211,107,.25));
    }
    .split-half .meta { display:flex; flex-direction:column; }
    .split-half .label {
      color: var(--muted); font-size:.78rem; letter-spacing:.5px; text-transform:uppercase; margin-bottom:3px;
    }
    .split-half .value { font-weight:800; font-size:1.35rem; letter-spacing:.3px; }
    .split-divider { width:1px; background: linear-gradient(180deg, transparent, rgba(255,211,107,0.75), transparent); }

    /* Stat grids */
    .section { background: linear-gradient(180deg, #111622, #0f131e); border:1px solid #1b2640; border-radius: 16px; padding: 18px; margin: 20px 0; box-shadow: 0 10px 22px rgba(0,0,0,.35); }
    .section h2 { margin: 2px 0 14px; font-size: 1.05rem; font-weight: 800; letter-spacing:.3px; color: #e6ecff; }
    .stats, .btc-metrics, .blockchain-metrics { display:grid; gap:14px; }
    .stats { grid-template-columns:repeat(5, minmax(0,1fr)); }
    .btc-metrics { grid-template-columns:repeat(4, minmax(0,1fr)); }
    .blockchain-metrics { grid-template-columns:repeat(4, minmax(0,1fr)); }
    .stat-box {
      background: linear-gradient(180deg, #1a2030, #121827);
      border: 1px solid #26314a; border-radius: 14px; padding: 14px 14px 12px;
      text-align:center; position:relative; transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .stat-box:hover { transform: translateY(-3px); box-shadow: 0 12px 22px rgba(0,0,0,.45); border-color: #334468; }
    .stat-box .icon { font-size:1.2rem; color: var(--accent); margin-bottom:6px; }
    .stat-box .label { color: var(--muted); font-size:.78rem; text-transform:uppercase; letter-spacing:.6px; }
    .stat-box .value { margin:6px 0 2px; font-size:1.15rem; font-weight:800; }
    .positive { color: var(--good); }
    .negative { color: var(--bad); }

    /* Chart + Table */
    .chart-card, .table-card {
      background: linear-gradient(180deg, #121827, #0e1421);
      border: 1px solid #1b2640; border-radius: 16px; padding: 16px;
      box-shadow: 0 12px 28px rgba(0,0,0,.38); margin: 22px 0;
    }
    .chart-head { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .chart-head h2 { margin: 0; font-size:1rem; font-weight:800; color:#e6ecff; }
    .chart-wrap { position: relative; width: 100%; height: 480px; }
    canvas { position:absolute; inset:0; width:100% !important; height:100% !important; }

    #date-range-slider { margin:18px 0 8px; }
    #date-range-labels { display:flex; justify-content:space-between; color:#d7def0; font-size:.85rem; }

    table { width:100%; border-collapse:collapse; font-size:.95rem; }
    thead th {
      background: #0f1522; color: #c8d4ff; text-align:left; padding:10px; position: sticky; top: 0;
      border-bottom: 1px solid #223152; letter-spacing:.3px; text-transform: uppercase; font-size:.8rem;
    }
    tbody td { padding:10px; border-bottom: 1px dashed #1f2b46; color: #e9eefc; }
    tbody tr:hover { background: rgba(90,200,250,0.06); }

    .error { color: var(--bad); text-align:center; margin:10px 0; font-weight: 700; }

    /* Responsive */
    @media (max-width: 1080px) { .stats { grid-template-columns:repeat(3,minmax(0,1fr)); } }
    @media (max-width: 820px)  { .btc-metrics, .blockchain-metrics { grid-template-columns:repeat(2,minmax(0,1fr)); } }
    @media (max-width: 680px)  {
      header { flex-direction:column; align-items:flex-start; gap:10px; }
      .split-tile { flex-direction:column; }
      .split-divider { height:1px; width:100%; }
      .stats { grid-template-columns:repeat(2,minmax(0,1fr)); }
    }
    @media (max-width: 480px)  { .stats { grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <img src="btc_tracker.png" alt="BTC tracker logo"/>
        <div>
          <h1>mjamiv BTC Tracker</h1>
          <p>Live portfolio tiles • Cost basis • Purchases • Gain</p>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="refreshBtn" title="Refresh data"><i class="fa-solid fa-rotate-right"></i> Refresh</button>
        <a class="btn secondary" href="https://github.com/mjamiv/btc_tracker" target="_blank" rel="noopener">
          <i class="fa-brands fa-github"></i> Repo
        </a>
      </div>
    </header>

    <!-- Split Tile: progress to 1 BTC -->
    <div class="split-tile" id="to-one-tile" title="Progress to 1 BTC at current market price">
      <div class="split-half" tabindex="0" aria-label="BTC needed to reach 1 BTC">
        <div class="icon"><i class="fa-solid fa-circle-half-stroke"></i></div>
        <div class="meta">
          <div class="label">BTC Needed for Whole-Coiner</div>
          <div class="value" id="btc-to-one">—</div>
        </div>
      </div>
      <div class="split-divider" aria-hidden="true"></div>
      <div class="split-half" tabindex="0" aria-label="USD needed at current price to reach 1 BTC">
        <div class="icon"><i class="fa-solid fa-dollar-sign"></i></div>
        <div class="meta">
          <div class="label">USD to Reach 1 BTC</div>
          <div class="value" id="usd-to-one">—</div>
        </div>
      </div>
    </div>

    <!-- Summary tiles -->
    <section class="section">
      <h2>Portfolio Summary</h2>
      <div class="stats" id="summary">
        <div class="stat-box" title="Total BTC">
          <i class="fas fa-coins icon"></i>
          <p class="label">Total BTC</p>
          <p class="value" id="total-btc">—</p>
        </div>
        <div class="stat-box" title="Total USD invested">
          <i class="fas fa-dollar-sign icon"></i>
          <p class="label">Total Invested</p>
          <p class="value" id="invested">—</p>
        </div>
        <div class="stat-box" title="Average cost per BTC">
          <i class="fas fa-calculator icon"></i>
          <p class="label">Cost Basis</p>
          <p class="value" id="cost-basis">—</p>
        </div>
        <div class="stat-box" title="Current USD value">
          <i class="fas fa-wallet icon"></i>
          <p class="label">Current Value</p>
          <p class="value" id="current-value">—</p>
        </div>
        <div class="stat-box" title="Unrealized gain/loss">
          <i class="fas fa-chart-line icon"></i>
          <p class="label">Gain/Loss</p>
          <p class="value" id="gain-loss">—</p>
        </div>
      </div>
    </section>

    <!-- BTC market tiles -->
    <section class="section">
      <h2>Market</h2>
      <div class="btc-metrics" id="btc-metrics">
        <div class="stat-box" title="Latest BTC price">
          <i class="fas fa-tag icon"></i>
          <p class="label">Current Price</p>
          <p class="value" id="btc-price">—</p>
        </div>
        <div class="stat-box" title="Market capitalization">
          <i class="fas fa-globe icon"></i>
          <p class="label">Market Cap</p>
          <p class="value" id="btc-market-cap">—</p>
        </div>
        <div class="stat-box" title="Trading volume (24h)">
          <i class="fas fa-exchange-alt icon"></i>
          <p class="label">24h Volume</p>
          <p class="value" id="btc-volume">—</p>
        </div>
        <div class="stat-box" title="Price change (24h)">
          <i class="fas fa-percentage icon"></i>
          <p class="label">24h Price Change</p>
          <p class="value" id="btc-price-change">—</p>
        </div>
      </div>
    </section>

    <!-- Blockchain tiles -->
    <section class="section">
      <h2>Blockchain</h2>
      <div class="blockchain-metrics" id="blockchain-metrics">
        <div class="stat-box" title="Current block height">
          <i class="fas fa-cubes icon"></i>
          <p class="label">Current Block</p>
          <p class="value" id="btc-block-height">—</p>
        </div>
        <div class="stat-box" title="Mining difficulty">
          <i class="fas fa-tachometer-alt icon"></i>
          <p class="label">Difficulty</p>
          <p class="value" id="btc-difficulty">—</p>
        </div>
        <div class="stat-box" title="Network hashrate">
          <i class="fas fa-microchip icon"></i>
          <p class="label">Hashrate</p>
          <p class="value" id="btc-hash-rate">—</p>
        </div>
        <div class="stat-box" title="Current block reward">
          <i class="fas fa-gift icon"></i>
          <p class="label">Block Reward</p>
          <p class="value" id="btc-block-reward">—</p>
        </div>
      </div>
    </section>

    <!-- Chart -->
    <section class="chart-card">
      <div class="chart-head">
        <h2>Bitcoin Price & Purchases Over Time</h2>
      </div>
      <div id="chart-error" class="error" role="alert"></div>
      <div class="chart-wrap">
        <canvas id="priceChart" aria-label="BTC price, cost basis, purchases and gain chart"></canvas>
      </div>
      <div id="date-range-slider" aria-label="Date range slider"></div>
      <div id="date-range-labels" aria-live="polite"></div>
    </section>

    <!-- Transactions table -->
    <section class="table-card">
      <h2>Transaction History</h2>
      <div class="table-container">
        <table aria-describedby="Transaction history table">
          <thead>
            <tr>
              <th>Date</th>
              <th>BTC Bought</th>
              <th>Total Cost</th>
              <th>Price at Tx</th>
              <th>Exchange</th>
            </tr>
          </thead>
          <tbody id="transactions-body"></tbody>
        </table>
      </div>
    </section>

    <div style="display:flex;gap:10px;justify-content:flex-end">
      <button class="btn" onclick="updateTracker()" title="Refresh data"><i class="fa-solid fa-rotate"></i> Refresh</button>
    </div>
  </div>

  <!-- App script -->
  <script src="script.js"></script>
  <script>
    // Also bind header refresh button without changing core behavior
    document.getElementById('refreshBtn')?.addEventListener('click', () => updateTracker());
  </script>
</body>
</html>
